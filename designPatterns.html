<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #demo > img {
            border-radius: 50%;
            border: 1px solid #eee;
            width: 500px;
            height: 500px;

        }
    </style>
</head>
<body>
    <button id="btn">点击</button>
    <div id="demo"></div>
    <script>
    //   function Test(name) {
    //     if (typeof Test.instance === 'object') {
    //         return Test.instance;
    //     }
    //     this.name = name
    //     Test.instance = this
    //   }
    //   var a = new Test('one');
    //   var b = new Test();

    //   console.log(a === b);

    // 改进
    // function Test(name) {
    //     var instance = this;
    //     this.name = name;
    //     Test = function() {
    //         return instance
    //     }
    // }
    // var a = new Test()
    // var b = new Test()
    // console.log(a === b)

    // 单例模式与圣杯模式
    // var Test = (function() {
    //     return function(name) {
    //         if (typeof instance === 'object') {
    //             return instance;
    //         }
    //         instance = this;
    //         this.name = name
    //     }
    // })()

    // var a = new Test();
    // Test.prototype.lastName = 'yang';
    // var b = new Test();

    // console.log(a == b, a.lastName, b.lastName)

    // 创建弹窗
    var createAlert = function(text) {
        var oDiv = document.createElement('div');
        oDiv.style.display = 'none';
        oDiv.innerText = text;
        document.body.appendChild(oDiv);
        return oDiv;
    }
    // btn.onclick = function() {
    //     var oDiv = createAlert('hello');
    //     oDiv.style.display = 'block';
    // }
    
    // 普通方法变成单例方法
    var getSingle = function(func) {
        var result;
        return function() {
            if (!result) {
                result = func.apply(this, arguments);
            }
            return result;
        }
    }

    var singleAlert = getSingle(createAlert);
    btn.onclick = function() {
        var oDiv = singleAlert('hello');
        oDiv.style.display = 'block';
    }


    // 代理模式
    var obj = {
        sendflower: function(target) {
            var flower = 'sunflower';
            target.receiveFlower(flower);
        }
    }

    var goddess = {
        mood: null,
        receiveFlower: function(flower) {
            this.mood ? console.log('ok') : console.log('get out')
        },
        changeMood: function() {
            this.mood = Math.random() > 0.5;
        },
        createMood: function() {
            var self = this;
            self.changeMood();
            setInterval(function() {
                self.changeMood();
            }, 400);
        }
    }

    var Proxy = {
        proxyFlower: function(target) {
            this.listenMood(target, function() {
                obj.sendflower(target);
            })
        },
        listenMood: function(target, cb) {
           var timer = setInterval(function() {
                if (target.mood) {
                    cb()
                    clearInterval(timer)
                }
            }, 500)
        }
    }
    goddess.createMood();
    Proxy.proxyFlower(goddess);


    var MyImage = function(id) {
        var oImg = new Image();
        this.setSrc = function(src) {
            oImg.src = src
        }
        document.getElementById(id).appendChild(oImg);
    }

    // var oMyImg = new MyImage('demo');
    // oMyImg.setSrc('./kenan.jpg');

    var ProxyImage = (function () {
        var oMyImg = new MyImage('demo');
        var oNewImage = new Image();

        oNewImage.onload = function () {
            oMyImg.setSrc(oNewImage.src);
        }
        return function (src) {
            oMyImg.setSrc('./kenan.jpg');
            oNewImage.src = src
        }
    })()

    ProxyImage('https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1598896283072&di=194679efc1aeb3f1a677eba374a47a25&imgtype=0&src=http%3A%2F%2Fimg3.imgtn.bdimg.com%2Fit%2Fu%3D3829077368%2C1463753918%26fm%3D214%26gp%3D0.jpg');
    </script>
</body>
</html>