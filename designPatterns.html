<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // 原始模式

        // var smallPlane = {
        //     width: 100,
        //     height: 100,
        //     blood: 100,
        //     touch:function() {
        //         this.blood -= 50;
        //         if (this.blood == 0) {
        //             console.log('die');
        //         } 
        //     }
        // }

        // 构造函数

        // function SmallPlane() {
        //     this.width = 100;
        //     this.height = 100;
        //     this.name = 'smallPlane';
        //     this.blood = 100;
        //     this.touch = function() {
        //         this.blood -= 50;
        //         if (this.blood == 0) {
        //             console.log('die');
        //         }
        //     }
        // }
        // // new SmallPlane();

        // function BigPlane() {
        //     this.width = 150;
        //     this.height = 200;
        //     this.name = 'bigPlane';
        //     this.blood = 200;
        //     this.touch = function() {
        //         this.blood -= 50;
        //         if (this.blood == 0) {
        //             console.log('die');
        //         }
        //     }
        // }
        // // new BigPlane();

        // 简单工厂模式


        // function PlaneFactory(type) {
        //     var newPlane = null;
        //     switch(type) {
        //         case 'smallPlane':
        //             newPlane = new SmallPlane();
        //             break;
        //         case 'bigPlane':
        //             newPlane = new BigPlane();
        //     }
        //     newPlane.touch = function() {
        //         console.log('die')
        //     }
        //     return newPlane
        // }

        // PlaneFactory('smallPlane');


        // 工厂方法模式
        function PlaneFactory() {
            this.decorate_list = []
        }
        // 集合所有装饰方法
        PlaneFactory.prototype.decorators = {
            eatOneLife: function(obj) {
                obj.blood += 100
            },
            eatTwoLife: function(obj) {
                obj.blood += 200
            },
            eatShrinkLife: function(obj) {
                obj.blood -= 50
            }
        }

        // 搜集对某对象的装饰描述
        PlaneFactory.prototype.decorate = function(decorator) {
            this.decorate_list.push(decorator)
        }

        PlaneFactory.prototype.empty = function() {
            this.decorate_list = []
        }

        PlaneFactory.prototype.remove = function(type) {
            this.decorate_list = this.decorate_list.filter(function(eleType) {
                return !(eleType === type);
            })
        }

        // 更新装修
        PlaneFactory.prototype.update = function() {
            for (var i = 0; i < this.decorate_list.length; i++) {
                this.decorators[ this.decorate_list[i] ] && this.decorators[ this.decorate_list[i] ](this);
            }
        }

        // 子类工厂都可以使用的公共方法
        PlaneFactory.prototype.touch = function() {
            this.blood -= 50;
            if (this.blood == 0) {
                this.die()
            }
        }
        PlaneFactory.prototype.die = function() {
            alert('boomb');
        }

        // 创建对象的接口
        PlaneFactory.create = function(type) {
            // 判断是否存在该子类工厂
            if (PlaneFactory.prototype[type] == undefined) {
                throw 'no this constructor';
            }

            // 继承
            if (PlaneFactory.prototype[type].prototype.__proto__ !== PlaneFactory.prototype) {
                PlaneFactory.prototype[type].prototype = new PlaneFactory();
            }

            var arg = [].slice.call(arguments, 1)
            var newPlane = new PlaneFactory.prototype[type](...arg)
            return newPlane

        }

        // 真正定义子类工厂
        PlaneFactory.prototype.SmallPlane = function(x, y) {
            this.x = x;
            this.y = y;
            this.width = 100;
            this.height = 100;
            this.name = 'smallPlane';
            this.blood = 100;
        }

        PlaneFactory.prototype.BigPlane = function(x, y) {
            this.x = x;
            this.y = y;
            this.width = 125;
            this.height = 200;
            this.name = 'bigPlane';
            this.blood = 200;
        }

        var oSp = PlaneFactory.create('SmallPlane', 10, 20)
        var oBp = PlaneFactory.create('BigPlane', 20, 30)

        // 装饰者模式
        oSp.decorate('eatOneLife');
        oSp.remove('eatOneLife');


        // 观察者模式
        function Event() {
            // 存储 不同事件类型对应不同处理函数
            this.cache = {}
        }
        Event.prototype.on = function(type, handle) {
            if (!this.cache[type]) {
                this.cache[type] = [handle]
            } else {
                this.cache[type].push(handle)
            }
        }
        Event.prototype.emmit = function() {
            var type = arguments[0];
            var arg = [].splice.call(arguments, 1);
            for (var i = 0; i < this.cache[type].length; i++) {
                this.cache[type][i].apply(this, arg)
            }
        }
        Event.prototype.remove = function(type, handle) {
            this.cache[type] =  this.cache[type].filter(function(ele) {
                return !(ele === handle)
            })
        }
        Event.prototype.empty = function() {
            this.cache[type] = []
        }
        Event.prototype.once = function(type, handle) {

        }
        var oE = new Event();
        function deal1(time) {
            console.log('overtime1' + time)
        }
        function deal2(time) {
            console.log('overtime2' + time)
        }
        oE.on('over', deal1);
        oE.on('over', deal2);
        oE.emmit('over', '2020-9-2');
        oE.remove('over', deal2);
        oE.emmit('over', 'second 2020-9-2');

    </script>
</body>
</html>